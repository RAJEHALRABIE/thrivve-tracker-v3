# متابع حافز ثرايف V3

تطبيق ويب خفيف (PWA) مخصص للجوال، لمتابعة وتحليل تحقيق شروط الحافز الأسبوعي لشركة **ثرايف (Thrivve)**، مع التركيز على:

- حساب ساعات العمل من مدد الرحلات الفعلية.
- تطبيق الشرط التصاعدي لعدد الرحلات بعد حد أدنى من الساعات.
- التحقق من أوقات الذروة بحسب سياسة الشركة.
- مراقبة نسبة القبول والإلغاء (من تطبيق أوبر/ثرايف).
- احتساب قيمة الحافز المتوقعة + الزيادة على الدخل.
- إنتاج تقرير أسبوعي HTML جاهز للطباعة أو التحويل إلى PDF.

> ⚠️ ملاحظة مهمة  
> هذا التطبيق **أداة شخصية للمراجعة والتحليل فقط**، ولا يرتبط بأي شكل رسمي بنظام ثرايف أو أوبر، ولا يضمن صرف الحافز. القرار النهائي دائمًا لدى الشركة.

---

## 1. فكرة المشروع

نظام الحافز الأسبوعي لثرايف يحتوي على مجموعة شروط، من أهمها:

1. حد أدنى لساعات العمل الأسبوعية.
2. حد أدنى لعدد الرحلات.
3. شرط تصاعدي: بعد تجاوز عدد ساعات معيّن، يجب زيادة عدد الرحلات بمعدل 1.5 رحلة لكل ساعة إضافية.
4. نسبة قبول لا تقل عن 65%.
5. نسبة إلغاء لا تزيد عن 10%.
6. أن تكون نسبة محددة من العمل في أوقات الذروة.

المشكلة أن التقرير الرسمي من الشركة لا يكون دائمًا واضحًا في طريقة الحساب (خصوصًا شرط الذروة)، لذلك تم بناء هذا التطبيق ليعطيك:

- **قراءة ذاتية عادلة** مبنية على بياناتك الفعلية التي تسجّلها بنفسك.
- **لوحة تحكم لحظية** خلال الأسبوع.
- **تقرير أسبوعي مفصل** يمكنك الاحتفاظ به كمرجع.

---

## 2. مميزات التطبيق

### 2.1. مخصص للجوال (Mobile-First)

- التصميم بالكامل مهيأ للجوال.
- يمكن تثبيته كـ **تطبيق مستقل (PWA)** على الشاشة الرئيسية.
- يعمل حتى بدون اتصال بعد تحميله مرة واحدة (بسبب الـ Service Worker).

### 2.2. إعدادات الحافز الأسبوعي

من قسم "إعدادات الحافز الأسبوعي" يمكنك ضبط:

- `الحد الأدنى لساعات العمل`  
- `الحد الأدنى لعدد الرحلات`  
- `الحد الأدنى لنسبة رحلات الذروة %`  
- `قيمة الحافز لكل رحلة (ريال)`  
- `نسبة القبول الرسمية الحالية %`  
- `نسبة الإلغاء الرسمية الحالية %`

هذه القيم تُقرأ من الرسالة التي ترسلها ثرايف كل يوم اثنين، ويمكنك تعديلها لأي أسبوع جديد.

### 2.3. تسجيل الرحلات

لكل رحلة:

- عند قبول الرحلة في أوبر:
  - تضغط زر **"بدء رحلة"** في التطبيق → يسجّل وقت البداية (تاريخ + ساعة + دقيقة + ثانية).
- عند إنهاء الرحلة في أوبر:
  - تضغط زر **"إنهاء الرحلة"** في التطبيق → يفتح نافذة:
    - إدخال **قيمة الرحلة الكاملة (ريال)**.
    - اختيار **طريقة الدفع**:
      - كاش
      - بطاقة
      - مختلط (كاش + بطاقة)
    - في حالة "مختلط" تدخل فقط:
      - **المبلغ الكاش المستلم من العميل**  
      - التطبيق يحسب الجزء الباقي على أنه بطاقة.
  - التطبيق يحسب تلقائيًا:
    - مدة الرحلة (بالثواني/الدقائق).
    - هل بداية الرحلة كانت في وقت ذروة أم لا (حسب وقت البداية).
- يتم حفظ الرحلة في جدول داخلي (سجل الرحلات) مع:
  - البداية – النهاية – المدة – القيمة – كاش – بطاقة – هل هي ذروة؟

### 2.4. لوحة معلومات (Dashboard)

الداشبورد يعرض لك لحظيًا:

- إجمالي عدد الرحلات.
- إجمالي ساعات العمل (محسوبة من مدد الرحلات).
- عدد رحلات الذروة + نسبتها من إجمالي الرحلات.
- نسبة وقت العمل في الذروة (حساب إضافي عادل مبني على زمن الرحلات).
- القيمة التقريبية للدخل الأساسي من الرحلات (مجموع قيم الرحلات).
- قيمة الحافز المتوقعة:  
  `عدد الرحلات × قيمة الحافز لكل رحلة`.
- نسبة الزيادة الفعلية على الدخل إذا تحقق الحافز.
- حالة الشروط:
  - هل حققت الحد الأدنى للساعات؟
  - هل حققت الشرط التصاعدي للرحلات؟
  - هل حققت نسبة رحلات الذروة المطلوبة؟
  - هل نسبة القبول ≥ 65% (حسب إدخالك)؟
  - هل نسبة الإلغاء ≤ 10% (حسب إدخالك)؟

يظهر شريط حالة في الأعلى:

- ✅ إذا كانت جميع الشروط المدخلة متحققة تقريبًا.
- ⚠️ إذا كانت بعض الشروط غير متحققة.
- نص واضح يوجّهك ما الذي يحتاج تحسين.

### 2.5. تقرير أسبوعي HTML قابل للطباعة

من الزر:

- **"عرض تقرير الأسبوع (للطباعة)"**

يفتح صفحة `report.html` التي تحتوي:

- ملخص رقمي للأسبوع:
  - عدد الرحلات، الساعات، الدخل، الحافز، عدد رحلات الذروة، إلخ.
- حالة كل شرط مع توضيح:
  - متحقق ✅ أو غير متحقق ❌.
- فقرة "قرار الحافز (تقديري حسب البيانات)":
  - إذا تحققت جميع الشروط المدخلة → يظهر أنك "منطقيًا مؤهل".
  - إذا لم تتحقق بعض الشروط → يظهر ملخص بما ينقص.
- جدول تفصيلي لكل رحلة.

يمكنك من المتصفح:

- الضغط على "طباعة" → اختيار "Save as PDF" لحفظ التقرير كملف PDF عربي.

---

## 3. بنية المشروع

المشروع Static بالكامل ويتكوّن من:

- `index.html`  
  الواجهة الرئيسية للتطبيق (الداشبورد + تسجيل الرحلات + الإعدادات).
- `report.html`  
  صفحة التقرير الأسبوعي المصمَّمة للطباعة/الـ PDF.
- `app.js`  
  منطق التطبيق كاملاً:
  - إدارة الحالة (state) + التخزين في `localStorage`.
  - حساب الشروط والنِّسَب وقيمة الحافز.
  - تسجيل الرحلات + حساب أوقات الذروة.
  - توليد محتوى التقرير.
- `manifest.json`  
  إعدادات الـ PWA (الاسم، الألوان، اللغة، وضع العرض).
- `sw.js`  
  Service Worker بسيط:
  - يخزن الملفات الأساسية في الكاش.
  - يسمح للتطبيق بالعمل أوفلاين بعد أول تحميل.

لا توجد أي قاعدة بيانات أو Backend، كل شيء يعمل على جهازك فقط.

---

## 4. طريقة التشغيل محليًا

1. فك ضغط الملف `thrivve-tracker-v3.zip`.
2. افتح المجلد الناتج.
3. قم بفتح ملف `index.html` في المتصفح (Chrome يفضّل).
4. جرّب التطبيق:
   - أدخل الإعدادات.
   - سجّل بعض الرحلات تجريبية.
   - افتح التقرير من زر "عرض تقرير الأسبوع".

> ⚠️ ملاحظة  
> من الأفضل تشغيله عبر خادم محلي بسيط (مثل Live Server أو `npx serve`) حتى تعمل الـ PWA والـ Service Worker بشكل كامل، لكن للاستخدام الشخصي السريع يمكن فتح `index.html` مباشرة.

---

## 5. النشر على Netlify

1. افتح حسابك في [Netlify](https://www.netlify.com).
2. من لوحة التحكّم:
   - اختر **"Add new site" → "Deploy manually"**.
3. اسحب مجلد المشروع بالكامل (بعد فك الضغط) وأفلته في منطقة الرفع.
4. سيقوم Netlify بنشر الموقع ويعطيك رابطًا مثل:  
   `https://your-name.netlify.app`
5. من الجوال:
   - افتح الرابط في Chrome.
   - من القائمة اختر "Add to Home screen" / "إضافة إلى الشاشة الرئيسية".
   - سيظهر لك كـ تطبيق مستقل تقريبًا.

---

## 6. طريقة الاستخدام العملية خلال الأسبوع

### بداية الأسبوع (يوم الاثنين)

1. افتح التطبيق من الجوال.
2. من قسم "إعدادات الحافز الأسبوعي":
   - أدخل القيم كما وردت في رسالة ثرايف لأول ذلك الأسبوع:
     - الحد الأدنى للساعات.
     - الحد الأدنى للرحلات.
     - الحد الأدنى لنسبة رحلات الذروة.
     - قيمة الحافز لكل رحلة (عادة 3 ريال).
   - أدخل:
     - نسبة القبول الرسمية الحالية من تطبيق أوبر/ثرايف.
     - نسبة الإلغاء الرسمية الحالية.
3. اضغط "حفظ الإعدادات وتحديث الحسابات".

### أثناء العمل اليومي

لكل رحلة:

1. عند **قبول** الرحلة في أوبر:
   - اضغط في التطبيق: **"بدء رحلة"**.
2. عند **إنهاء** الرحلة في أوبر:
   - اضغط في التطبيق: **"إنهاء الرحلة الحالية"**.
   - أدخل قيمة الرحلة الكاملة (المدوّنة في التطبيق).
   - اختر طريقة الدفع:
     - كاش → أدخل قيمة الرحلة، التطبيق سيعتبر كامل المبلغ كاش.
     - بطاقة → أدخل قيمة الرحلة، التطبيق سيعتبر كامل المبلغ بطاقة.
     - مختلط:
       - أدخل قيمة الرحلة الكاملة.
       - أدخل **المبلغ الكاش فقط** المستلم من العميل.
       - التطبيق يحسب الباقي على أنه بطاقة/محفظة.
   - اضغط "حفظ الرحلة".

> التطبيق يسجّل وقت البداية ووقت النهاية من جهازك، ويحدد وقت الذروة بناءً على **وقت بداية الرحلة**.

### نهاية الأسبوع (بعد يوم الأحد)

1. اضغط "عرض تقرير الأسبوع (للطباعة)".
2. سيفتح صفحة `report.html` برقم الأسبوع الحالي.
3. من المتصفح:
   - اضغط Print / طباعة → احفظ كـ PDF.
4. احتفظ بالملف كأرشيف شخصي، يمكنك استخدامه عند النقاش مع الشركة.

---

## 7. منطق الحوافز كما يطبّقه التطبيق

### 7.1. الساعات

- يتم حساب ساعات العمل من مجموع مدد الرحلات (ثواني → دقائق → ساعات).
- **لا** يتم الاعتماد على "ساعات اتصال التطبيق" الرسمية، بل على وقت قيادتك الفعلي.

### 7.2. عدد الرحلات والشرط التصاعدي

- الحد الأدنى الأساسي للرحلات = `minTrips`.
- إذا كانت ساعات العمل `H` أكبر من `minHours`:
  - الساعات الإضافية = `H - minHours`.
  - الرحلات الإضافية المطلوبة ≈ `ceil(extraHours × 1.5)`.
  - إجمالي الرحلات المطلوبة = `minTrips + extraTrips`.
- التطبيق يحسب:
  - كم رحلة لازال ينقصك لتحقيق هذا الشرط، إن وجد نقص.

### 7.3. الذروة

- يتم تصنيف الرحلة ذروة / غير ذروة بناءً على **وقت بداية الرحلة**:
  - الأحد–الأربعاء: من 06:00 صباحًا إلى 19:00.
  - الخميس: من 06:00 صباحًا إلى 01:00 فجرًا (الجمعة).
  - الجمعة والسبت: من 18:00 مساءً إلى 01:00 فجر اليوم التالي.
- التطبيق يعطيك:
  - نسبة رحلات الذروة = (عدد الرحلات التي بدأت داخل الذروة ÷ إجمالي الرحلات) × 100.
  - نسبة وقت العمل في الذروة = (مجموع مدد الرحلات التي بدأت في الذروة ÷ مجموع مدد جميع الرحلات) × 100 (لإنصاف وقتك فعليًا).

### 7.4. القبول والإلغاء

- التطبيق **لا يحسب هذه النسب بنفسه**، بل يعتمد على إدخالك:
  - نسبة القبول الرسمية من تطبيق أوبر/ثرايف.
  - نسبة الإلغاء الرسمية.
- ويستخدمها فقط للتحقق من:
  - هل القبول ≥ 65%؟
  - هل الإلغاء ≤ 10%؟

---

## 8. الخصوصية وحدود التطبيق

- جميع البيانات (الرحلات، الإعدادات، النِّسَب) محفوظة في **localStorage** على نفس الجهاز/المتصفح.
- لا يتم إرسال أي بيانات إلى خوادم خارجية من خلال هذا التطبيق نفسه.
- حذف بيانات الأسبوع يتم يدويًا من خلال:
  - زر "بدء أسبوع جديد" → يمسح الرحلات فقط من هذا الجهاز.

> ⚠️ تنبيه  
> أي اختلاف بين الأرقام التي يعطيها التطبيق وأرقام الشركة يعتبر نقطة نقاش تستخدمها أنت لفهم أين الفرق، لكنه **لا يُلزم الشركة** بأي شيء.

---

## 9. أفكار تطوير مستقبلية (اختيارية)

- إضافة خيار:
  - تصدير بيانات الأسبوع بصيغة CSV.
- دعم:
  - تعيين اسم للأسبوع (Week Label).
- عرض:
  - مخططات بسيطة (Charts) للذروة وساعات العمل اليومية.
- دعم:
  - نسخ احتياطي يدوي للبيانات واستعادتها.

---

## 10. ترخيص

هذا المشروع مخصص للاستخدام الشخصي، ويمكن تعديله وتطويره بما يناسب احتياجك، مع تحملك الكامل لمسؤولية استخدامه ونتائج تحليله.
